                         4 .list
                         5 **
                         6 ** Address Book
                         7 ** address_book.s
                         8 **
                         9 .section .text
                        10 start:
000400 7000             11     move.l #0,%d0 /* STRUCTの引数 */
000402 4EBA 0006        12     jsr STRUCT /* STRUCT(%d0.l) → NAME_DATA,ADDRESS_DATA */
000406 4E72 2700        13     stop #0x2700 /* プログラム終了 */
                        14 
                        15 
                        16 **************************************************
                        17 ** 構造体の構造
                        18 **************************************************
                        19 .equ NAME,0 /* NAME は先頭から0byte目 */
                        20 .equ ADDRESS,20 /* ADDRESS は先頭から20byte目 */
                        21 .equ SIZE,60 /* 一人分のデータサイズは60byte */
                        22 
                        23 
                        24 **************************************************
                        25 ** 構造体の要素を取り出すサブルーチン
                        26 **
                        27 ** 引数     %d0.l = 構造体のインデックス番号
                        28 ** 戻り値   NAME_DATA(名前のデータ)
                        29 **          ADDRESS_DATA(住所のデータ)
                        30 **************************************************
                        31 STRUCT:
                        32     * レジスタ退避
00040a 48E7 FFFE        33     movem.l %d0-%d7/%a0-%a6, -(%sp)
                        34 
00040e C0FC 003C        35     mulu    #SIZE, %d0          /* d0.l=取り出すインデックス番号×60 */
000412 0680 0000        36     add.l   #ADDRESS_BOOK, %d0  /* d0.l=取り出す要素の先頭アドレス */
       0000             36 
000418 2040             37     movea.l %d0, %a0            /* a0.l=d0.l */
00041a 7200             38     moveq.l #0, %d1             /* d1.l=0 ループカウンタの初期化*/
00041c 45F9 0000        39     lea.l   NAME_DATA, %a2      /* 書き出す領域の先頭アドレス */
       0000             39 
000422 2248             40     movea.l %a0, %a1            /* a1.l=a0 */
                        41 
                        42 NAME_LOOP: /* NAMEを書き出すルーチン */
000424 14D9             43     move.b  (%a1)+, (%a2)+      /* NAMEの書き出し */
000426 5281             44     addq.l  #1,  %d1            /* ループカウンタ++ */
000428 0C81 0000        45     cmp.l   #20, %d1            /* ループカウンタ<20 ならば */
       0014             45 
00042e 6600 FFF4        46     bne     NAME_LOOP           /* NAME_LOOPへ */
                        47 
000432 7200             48     moveq.l #0,  %d1            /* d1.l=0 ループカウンタの初期化 */
000434 45F9 0000        49     lea.l   ADDRESS_DATA, %a2   /* 書き出す領域の先頭アドレス */
       0000             49 
00043a 2248             50     movea.l %a0,  %a1           /* a1.l=a0.l */
00043c D3FC 0000        51     adda.l  #ADDRESS, %a1       /* a1.l=a1.l+ADDRESS */
       0014             51 
                        52 
                        53 ADDRESS_LOOP: /* ADDRESSを書き出すルーチン */
000442 14D9             54     move.b  (%a1)+, (%a2)+      /* ADDRESSの書き出し */
000444 5281             55     addq.l  #1,  %d1            /* ループカウンタ++ */
000446 0C81 0000        56     cmp.l   #40, %d1            /* ループカウンタ<40ならば */
       0028             56 
00044c 6600 FFF4        57     bne ADDRESS_LOOP            /* ADDRESS_LOOPへ */
                        58 
                        59     * レジスタの復帰
000450 4CDF 7FFF        60     movem.l (%sp)+, %d0-%d7/%a0-%a6
000454 4E75             61     rts                         /* サブルーチンから復帰*/
                        62 
                        63 
                        64 **************************************************
                        65 ** 住所録
                        66 ** NAME の長さ20byte
                        67 ** ADDRESS の長さは40byte
                        68 **************************************************
                        69 .section .data
                        70 ADDRESS_BOOK:
000458 5441 524F        71     .ascii "TAROU               "                       /* NAME */
       5520 2020        71 
       2020 2020        71 
       2020 2020        71 
       2020 2020        71 
00046c 4855 4B55        72     .ascii "HUKUOKASHI HIGASHIKU                    "   /* ADDRESS */
       4F4B 4153        72 
       4849 2048        72 
       4947 4153        72 
       4849 4B55        72 
                        73 
000494 4841 4E41        74     .ascii "HANAKO              "                       /* NAME */
       4B4F 2020        74 
       2020 2020        74 
       2020 2020        74 
       2020 2020        74 
0004a8 4855 4B55        75     .ascii "HUKUOKASHI MINAMIKU                     "   /* ADDRESS */
       4F4B 4153        75 
       4849 204D        75 
       494E 414D        75 
       494B 5520        75 
                        76 
                        77 
                        78 **************************************************
                        79 ** STRUCTの出力
                        80 **************************************************
0004d0 0000 0000        81 NAME_DATA:      .ds.b 20 /* NAME出力先 */
       0000 0000        81 
       0000 0000        81 
       0000 0000        81 
       0000 0000        81 
0004e4 0000 0000        82 ADDRESS_DATA:   .ds.b 40 /* ADDRESS出力先*/
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
       0000 0000        82 
                        83 
                        84 .end
