                         4 .list
                         5 *******************************
                         6 ** メモリ破壊（Drawing characters）
                         7 *******************************
                         8 
                         9 .section .text
                        10 start:
000400 41F9 0000        11     lea.l   DATA0,%a0   /* 描画する絵の先頭アドレスをa0に格納 */
       0000             11 
000406 43F9 0000        12     lea.l   VIEWTOP,%a1 /* 描画する領域の先頭アドレスをa1に格納 */
       0000             12 
00040c 45F9 0000        13     lea.l   CONTROL,%a2 /* 制御用コードの先頭アドレスをa2に格納 */
       0000             13 
000412 4EBA 001E        14     jsr     INIT        /* 背景を描画するサブルーチンに分岐 */
000416 4EBA 0032        15     jsr     DRAW        /* 描画領域の左上を初期位置として絵を描画 */
                        16 
                        17 LOOP1:
00041a 0C12 0004        18     cmp.b   #4, (%a2)   /* 制御用コードを見て終了（4）を判定 */
00041e 6700 000E        19     beq     end_of_program
000422 4EBA 0048        20     jsr     UPDATE      /* 描画位置の更新 */
000426 4EBA 0022        21     jsr     DRAW        /* 更新された位置（正しくは方向）に絵を描画 */
00042a 6000 FFEE        22     bra     LOOP1
                        23 
                        24 end_of_program:
00042e 4E72 2700        25     stop #0x2700 /* プログラムの終了 */
                        26 
                        27 
                        28 ************************************
                        29 ** 背景を#INITCHARで埋める
                        30 ** 引数：%a1 = 背景となるデータ領域の先頭アドレス
                        31 ** #AREASIZE = 描画領域の大きさ
                        32 ************************************
                        33 INIT:
000432 48E7 8040        34     movem.l %d0/%a1,   -(%a7)   /* このサブルーチンで使うレジスタを退避 */
000436 303C 0100        35     move.w  #AREASIZE, %d0
                        36 LOOP2:
00043a 12FC 00EE        37     move.b  #INITCHAR, (%a1)+
00043e 5340             38     subq.w  #1, %d0
000440 6600 FFF8        39     bne     LOOP2
000444 4CDF 0201        40     movem.l (%a7)+, %d0/%a1     /* レジスタの回復 */
000448 4E75             41     rts
                        42 
                        43 
                        44 *************************************
                        45 ** DRAW
                        46 ** 引数：
                        47 ** %a0=動かす絵の先頭アドレス
                        48 ** %a1=絵を描画する領域の先頭アドレス（描画位置）
                        49 *************************************
                        50 DRAW:
00044a 48E7 C0C0        51     movem.l %d0-%d1/%a0-%a1,-(%a7) /* レジスタの退避 */
                        52 
00044e 7004             53     moveq.l #LENGTHX,%d0
000450 7204             54     moveq.l #LENGTHY,%d1
                        55 
                        56 LOOP3:
000452 12D8             57     move.b  (%a0)+, (%a1)+
000454 5340             58     subq.w  #1, %d0
000456 6600 FFFA        59     bne     LOOP3
                        60 
00045a D2FC 000C        61     adda.w  #16-LENGTHX, %a1
00045e 7004             62     moveq.l #LENGTHX, %d0
000460 5341             63     subq.w  #1, %d1
000462 6600 FFEE        64     bne     LOOP3
000466 4CDF 0303        65     movem.l (%a7)+, %d0-%d1/%a0-%a1 /* レジスタの回復 */
00046a 4E75             66     rts
                        67 
                        68 
                        69 *************************************
                        70 ** 制御コードによる絵の位置情報（アドレス）の更新
                        71 ** 引数
                        72 ** %a2=現在の制御コードが格納してあるアドレス
                        73 ** 戻り値
                        74 ** %a1=絵を描画する領域の先頭アドレス（位置）
                        75 *************************************
                        76 UPDATE:
00046c 0C12 0000        77     cmpi.b  #0, (%a2) /* 右に動かす */
000470 6700 001A        78     beq     RIGHT
000474 0C12 0001        79     cmpi.b  #1, (%a2) /* 左に動かす */
000478 6700 001A        80     beq     LEFT
00047c 0C12 0002        81     cmpi.b  #2, (%a2) /* 上に動かす */
000480 6700 001A        82     beq     UP
000484 0C12 0003        83     cmpi.b  #3, (%a2) /* 下に動かす */
000488 6700 001A        84     beq     DOWN
                        85 
                        86 RIGHT:
00048c D2FC 0001        87     adda.w  #1, %a1
000490 6000 001A        88     bra     FINISH
                        89 LEFT:
000494 92FC 0001        90     suba.w  #1, %a1
000498 6000 0012        91     bra     FINISH
                        92 UP:
00049c 92FC 0010        93     suba.w  #0x10, %a1
0004a0 6000 000A        94     bra     FINISH
                        95 DOWN:
0004a4 D2FC 0010        96     adda.w  #0x10, %a1
0004a8 6000 0002        97     bra     FINISH
                        98 FINISH:
0004ac D4FC 0001        99     adda.w  #1, %a2
0004b0 4E75            100     rts
                       101 
                       102 
                       103 .section .data
                       104 ***********************************
                       105 ** Data Area
                       106 ***********************************
                       107 .equ LENGTHX,  4        /* 描画する絵の横幅（バイト単位） */
                       108 .equ LENGTHY,  4        /* 描画する絵の縦幅（バイト単位） */
                       109 .equ INITCHAR, 0xee     /* 背景に使う”文字(0x00-0xff) */
                       110 .equ AREASIZE, 0x100    /* 描画に使用する領域の大きさ */
                       111 
0004b4 EEEE EEEE       112 DATA0: .dc.b INITCHAR, INITCHAR, INITCHAR, INITCHAR /* 描画する絵の一部 */
0004b8 EE44 77EE       113 DATA1: .dc.b INITCHAR, 0x44,     0x77,     INITCHAR /* 描画する絵の一部 */
0004bc EE44 77EE       114 DATA2: .dc.b INITCHAR, 0x44,     0x77,     INITCHAR /* 描画する絵の一部 */
0004c0 EEEE EEEE       115 DATA3: .dc.b INITCHAR, INITCHAR, INITCHAR, INITCHAR /* 描画する絵の一部 */
                       116 
0004c4 0000 0000       117 CONTROL: .dc.b 0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,0,0,0,0,
       0000 0000       117 
       0000 0303       117 
       0303 0303       117 
       0303 0303       117 
                       118 * CONTROL:.dc.b 0,0,0,0,0,0,0,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,4 /* 絵の制御用コード */
                       119 
0004ff 0000 0000       120 VIEWTOP: .ds.b AREASIZE /* 領域の確保 */
       0000 0000       120 
       0000 0000       120 
       0000 0000       120 
       0000 0000       120 
                       121 
                       122 .end
